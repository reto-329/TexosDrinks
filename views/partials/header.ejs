<!-- views/partials/header.ejs -->
<head>
    <meta name="user-logged-in" content="<%= typeof user !== 'undefined' && user ? 'true' : 'false' %>">
</head>
<header class="header" id="header">
    <div class="container">
        <div class="header-content">
            <a href="/" class="logo">
                <img src="/Images/logo1.png" alt="Texos Drinks Logo" class="logo-img">
                <span class="logo-accent1">TEXOS<span class="logo-accent2">DRINKS</span></span>
            </a>
            
            <!-- Desktop Navigation -->
            <nav class="nav-desktop">
                <a href="/" class="nav-link">Home</a>
                <a href="/product" class="nav-link">Products</a>
                <a href="/about" class="nav-link">About</a>
                <a href="/contact" class="nav-link">Contact</a>
            </nav>

            <div class="header-actions">
                <a href="/cart" class="cart-btn" aria-label="Shopping cart">
                    <div class="cart-icon-wrapper">
                        <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                </a>

                <div class="user-dropdown">
                    <button class="user-dropdown-btn" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-user"></i> Account <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="user-dropdown-content">
                        <a href="/adminLogin"><i class="fas fa-user-shield"></i> Admin</a>
                        <a href="/login"><i class="fas fa-sign-in-alt"></i> Customer</a>
                    </div>
                </div>

                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle mobile menu">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <nav class="nav-mobile" id="mobileNav">
            <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
            <a href="/products" class="nav-link"><i class="fas fa-box-open"></i> Products</a>
            <a href="/about" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
            <a href="/contact" class="nav-link"><i class="fas fa-envelope"></i> Contact</a>
            <div class="mobile-user-menu">
                <a href="/adminLogin" class="nav-link"><i class="fas fa-user-shield"></i> Admin</a>
                <a href="/login" class="nav-link"><i class="fas fa-sign-in-alt"></i> Login</a>
            </div>
        </nav>
    </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileNav = document.getElementById('mobileNav');
    
    if (mobileMenuBtn && mobileNav) {
        mobileMenuBtn.addEventListener('click', function() {
            mobileNav.classList.toggle('active');
            mobileMenuBtn.classList.toggle('active');
            const icon = mobileMenuBtn.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });
    }

    // User dropdown
    const userDropdownBtn = document.querySelector('.user-dropdown-btn');
    const userDropdownContent = document.querySelector('.user-dropdown-content');
    
    if (userDropdownBtn && userDropdownContent) {
        userDropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            const isExpanded = userDropdownBtn.getAttribute('aria-expanded') === 'true';
            userDropdownBtn.setAttribute('aria-expanded', !isExpanded);
            userDropdownContent.style.display = isExpanded ? 'none' : 'block';
        });

        // Close when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-dropdown')) {
                userDropdownContent.style.display = 'none';
                userDropdownBtn.setAttribute('aria-expanded', 'false');
            }
        });
    }
});

function logout() {
    fetch('/api/users/logout', {
        method: 'POST',
        credentials: 'same-origin'
    }).then(() => {
        showLogoutNotification('/');
    });
}

function showLogoutNotification(redirectUrl) {
    const notification = document.createElement('div');
    notification.className = 'logout-notification';
    notification.textContent = 'You have been logged out.';
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
        window.location.href = redirectUrl;
    }, 2000);
}
</script>

<style>
.logout-notification {
    position: fixed;
    top: 30px;
    right: 30px;
    background: var(--primary-color);
    color: var(--white);
    padding: 1rem 1.5rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    animation: fadeInOut 2s ease;
}

@keyframes fadeInOut {
    0%, 100% { opacity: 0; transform: translateY(-1rem); }
    10%, 90% { opacity: 1; transform: translateY(0); }
}
</style>